version: "3.8"

services:
  medication-reminder:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: registry.heydtmann.eu:5000/medication-reminder:latest
    environment:
      - TZ=Europe/Berlin
      - DATA_DIR=/data
      - DEBUG=false
    volumes:
      - /data/dockervolumes/mrem:/data
      - /home/rdpuser/projects/medication-reminder/backend/app.py:/app/app.py:ro
      - /home/rdpuser/projects/medication-reminder/frontend:/app/../frontend:ro
    networks:
      - test-o
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.hostname == pi6
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 64M

networks:
  test-o:
    external: true
